# 用户需求文档 (URD) - Web Filter Chrome Extension

## 1. 产品简介
本产品是一款 Chrome 浏览器扩展程序，旨在根据用户自定义的关键词列表，智能识别并屏蔽网页中的特定元素（如推文、视频卡片等）。初版重点优化 Twitter(X), YouTube, Bilibili 等主流内容消费平台的使用体验。

## 2. 用户角色
- **普通用户**: 希望避免看到特定话题（如政治、剧透、令人不适的内容）的互联网使用者。

## 3. 功能需求

### 3.1 关键词管理
- **添加关键词**: 用户可以通过插件弹窗或设置页面添加需要屏蔽的单词或短语。
- **删除关键词**: 用户可以移除已添加的关键词。
- **列表查看**: 用户可以清晰地查看当前生效的所有关键词。
- **匹配策略**:
  - **不区分大小写 (Case-insensitive)**: 例如输入 "trump"，将同时屏蔽 "Trump", "TRUMP"。
  - **子字符串匹配 (Substring Match)**: 例如输入 "剧透"，将屏蔽包含 "严重剧透警告" 的内容。

### 3.2 关键词时效设置 *(v1.1 新增)*
- **有效期选项**: 添加关键词时可选择：
  - **永久有效** (默认): 关键词长期保留，直到用户手动删除。
  - **30天有效**: 关键词在添加后 30 天自动过期删除。
- **过期清理**: 插件加载配置时自动移除已过期的关键词。
- **过期提醒**: 即将过期（7 天内）的关键词在 UI 上显示黄色警告标签。

### 3.3 关键词导入/导出 *(v1.1 新增)*
- **导出功能**: 用户可将当前所有关键词导出为 JSON 文件备份。
  - 导出文件包含版本号、导出时间戳和完整关键词列表（含过期时间）。
- **导入功能**: 用户可从 JSON 文件导入关键词。
  - 增量导入：自动跳过已存在的重复关键词。
  - 兼容纯字符串数组格式（旧版备份）。
- **示例文件**: 提供 `docs/keywords_sample.json` 作为导入格式参考。

### 3.4 智能内容屏蔽 (核心功能)
插件需通过 DOM 操作，智能识别并**彻底隐藏**包含关键词的逻辑内容块（使用 `display: none`，不保留占位）。

- **通用逻辑**:
  - V1 版本为降低因误删父容器导致的页面崩坏风险，**仅在预设的白名单站点（X, YT, Bili）启用高级屏蔽逻辑**。
  - 对于非白名单站点，若用户强制开启，仅尝试隐藏包含关键词的**最末级文本节点**或其直接父元素（实验性功能）。
- **特定站点适配 (优先支持)**:
  - **Twitter / X**:
    - 检测推文文本。
    - 若包含关键词，屏蔽整条推文 (`<article>` 或特定 class 的容器)。
  - **YouTube**:
    - 检测视频标题、频道名。
    - 若包含关键词，屏蔽整个视频预览卡片 (`ytd-rich-item-renderer`, `ytd-video-renderer` 等)。
  - **Bilibili**:
    - 检测视频标题、UP主名称、动态内容。
    - 若包含关键词，屏蔽对应的视频卡片或动态条目。

### 3.5 站点启用管理 (白名单/黑名单机制)
- **默认策略**:
  - 插件设计为 **默认关闭**。即在用户未访问过的普通网站上，不自动进行过滤操作，以免误伤或消耗性能。
  - **预设白名单**: 针对 **Twitter (X), YouTube, Bilibili**，默认 **开启** 过滤功能。
- **用户控制**:
  - 用户点击插件图标唤起弹窗 (Popup)。
  - 弹窗内提供"在当前网站启用/禁用"的开关。
  - 插件需**记住**用户对特定域名的开关选择（持久化存储）。

### 3.6 统计反馈 (可选)
- 在插件图标或弹窗上显示当前页面已屏蔽的元素数量，让用户感知插件正在工作。

## 4. 非功能需求 (NFR)

### 4.1 性能要求
- 使用 `MutationObserver` 监听动态加载的内容（如无限滚动的 Feed 流）。
- 过滤算法需高效，避免造成页面滚动卡顿。

### 4.2 隐私与安全
- **数据同步**: 使用 `chrome.storage.sync` 存储关键词列表和配置，以便在用户登录同一 Google 账号的不同设备间自动同步。
- **无数据回传**: 不收集用户的浏览历史或关键词数据。

### 4.3 数据迁移兼容性 *(v1.1 新增)*
- 旧版本用户升级后，原有的字符串格式关键词列表自动迁移为新对象格式 `{word, expiresAt}`。
- 迁移过程透明，无需用户手动操作。

## 5. UI/UX 交互草图
1. **浏览器工具栏图标**:
   - 灰色: 当前站点未启用。
   - 彩色/高亮: 当前站点已启用。
   - Badge (角标): 显示屏蔽数量 (e.g., "3")。
2. **Popup 弹窗**:
   - 顶部: 当前网站域名 (e.g., youtube.com)。
   - 开关: [开启/关闭] (针对当前站点)。
   - 快速添加框: [ 输入关键词 ] [添加]。
   - 链接: [管理所有关键词] (跳转至选项页)。
3. **设置页 (Options)**:
   - 关键词列表管理 (Tag 形式，支持删除，显示过期时间)。
   - 添加关键词区域 (含有效期选择器：永久/30天)。
   - **导入/导出区域** *(v1.1 新增)*: [📤 导出关键词] [📥 导入关键词] 按钮。
   - 自定义站点列表管理 (查看哪些网站被开启/关闭了)。

## 6. 技术栈
- **Core**: JavaScript (ES6+), HTML, CSS
- **Framework**: Vanilla JS (推荐，轻量) 或 Vue/React (如果UI复杂)
- **Manifest Version**: V3
